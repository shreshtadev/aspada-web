---
import { Image } from 'astro:assets'
import logo from '../assets/Logo.png'
import pb from '../lib/pb'
const isAuthenticated = pb.authStore.isValid
const { companyProfile } = Astro.props
---

<style>
  /* NAVBAR SCROLL STATES */
  html[data-scrolled] #navbar-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    border-color: rgba(120, 130, 140, 0.1);
  }

  html:not([data-scrolled]) #navbar-container {
    background: rgba(22, 42, 71, 0.2);
    backdrop-filter: blur(6px);
    border-color: rgba(255, 255, 255, 0.05);
  }

  /* HOVER BEHAVIORS */
  .nav-link {
    border-bottom: 2px solid transparent;
    transition: all 0.2s ease;
  }
  html:not([data-scrolled]) .nav-link:hover {
    background: rgba(22, 42, 71, 0.2);
    backdrop-filter: blur(6px);
    color: #d4af37 !important;
    border-bottom-color: #d4af37 !important;
  }
  html[data-scrolled] .nav-link:hover {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    color: #d4af37 !important;
    border-bottom-color: #d4af37 !important;
  }
  .social-icon:hover {
    color: #d4af37 !important;
  }

  /* SCROLL TEXT COLORS */
  html[data-scrolled] .nav-link,
  html[data-scrolled] .social-icon,
  html[data-scrolled] #mobile-menu-toggle {
    color: #2e5a88;
  }

  html:not([data-scrolled]) .nav-link,
  html:not([data-scrolled]) .social-icon,
  html:not([data-scrolled]) #mobile-menu-toggle {
    color: white;
  }

  /* MOBILE MENU ANIMATION */
  #mobile-menu {
    visibility: hidden;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease-in-out;
  }

  html[data-menu-open] #mobile-menu {
    visibility: visible;
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  /* Hamburger Icon Switch */
  html[data-menu-open] #menu-icon {
    /* Changes menu icon to an 'X' via Lucide class if available, or simple rotation */
    transform: rotate(90deg);
  }

  /* Default state (Large) */
  .logo-shield {
    clip-path: polygon(0% 0%, 100% 0%, 100% 80%, 50% 100%, 0% 80%);
    width: 7rem;
    height: 9rem;
    padding: 1rem;
  }

  /* Scrolled state (Reduced) */
  html[data-scrolled] .logo-shield {
    width: 5rem; /* Reduced width */
    height: 6rem; /* Reduced height */
    padding: 0.5rem;
  }

  /* Scale the actual image inside */
  html[data-scrolled] .logo-shield img {
    height: 5rem !important; /* Reduced image height */
  }

  /* Adjust the spacer so the navbar doesn't feel empty */
  html[data-scrolled] .logo-shield + div {
    height: 5rem;
  }
</style>

<nav id="main-navbar" class="fixed top-0 left-0 w-full z-[100]">
  <div
    id="navbar-container"
    class="px-6 py-0 md:h-20 flex justify-between items-center transition-all duration-300"
  >
    <div class="hidden md:flex flex-1"></div>

    <div class="flex items-center gap-8 justify-center shrink-0">
      <a href="/" class="group relative flex items-start">
        <div
          class="logo-shield absolute top-0 -translate-x-[200%] z-[110]
           bg-aspada-navy shadow-xl flex items-center justify-center
           transition-all duration-500 ease-in-out
           html-scrolled:w-20 html-scrolled:h-24"
          id="logo-shield-box"
        >
          <Image
            src={logo}
            alt="Logo"
            class="h-16 w-auto object-contain transition-all duration-500 html-scrolled:h-12"
          />
        </div>
        <div class="w-24 h-24 transition-all duration-500 html-scrolled:h-20"></div>
      </a>

      <div class="hidden md:flex gap-4 items-center">
        <a href="/" class="nav-link px-3 py-2 text-xl font-semibold uppercase">Home</a>
        <a href="/projects/plots" class="nav-link px-3 py-2 text-xl font-semibold uppercase"
          >Layouts</a
        >
        <a href="/projects/residential" class="nav-link px-3 py-2 text-xl font-semibold uppercase"
          >Residential</a
        >
        <a href="/projects/commercial" class="nav-link px-3 py-2 text-xl font-semibold uppercase"
          >Commercial</a
        >
        <a href="/blog" class="nav-link px-3 py-2 text-xl font-semibold uppercase">News</a>
      </div>
    </div>

    <div class="flex flex-1 justify-end items-center gap-4 mr-10">
      <div class="hidden lg:flex gap-4">
        <a href={companyProfile?.companyInsta} class="social-icon i-lucide-instagram text-2xl"></a>
        <a href={companyProfile?.companyFacebook} class="social-icon i-lucide-facebook text-2xl"
        ></a>
        <a href={companyProfile?.companyYoutube} class="social-icon i-lucide-youtube text-2xl"></a>
        {
          isAuthenticated ? (
            <a href="/admin" class="social-icon i-lucide-user text-2xl" />
          ) : (
            <a href="/admin/login" class="social-icon i-lucide-log-in text-2xl" />
          )
        }
      </div>

      <button id="mobile-menu-toggle" class="md:hidden z-[120] relative p-2" aria-label="Open Menu">
        <div id="menu-icon" class="i-lucide-menu text-3xl transition-transform"></div>
      </button>
    </div>
  </div>

  <div
    id="mobile-menu"
    class="fixed inset-0 z-[105] bg-aspada-navy bg-opacity-95 flex flex-col items-center justify-center gap-8 md:hidden"
  >
    <a
      href="/"
      class="text-white hover:text-aspada-gold hover:border-b-2 hover:border-aspada-gold transition-border duration-300 text-3xl font-bold uppercase"
      >Home</a
    >
    <a
      href="/projects/plots"
      class="text-white hover:text-aspada-gold hover:border-b-2 hover:border-aspada-gold transition-border duration-300 text-3xl font-bold uppercase"
      >Layouts</a
    >
    <a
      href="/projects/residential"
      class="text-white hover:text-aspada-gold hover:border-b-2 hover:border-aspada-gold transition-border duration-300 text-3xl font-bold uppercase"
      >Residential</a
    >
    <a
      href="/projects/commercial"
      class="text-white hover:text-aspada-gold hover:border-b-2 hover:border-aspada-gold transition-border duration-300 text-3xl font-bold uppercase"
      >Commercial</a
    >
    <a
      href="/blog"
      class="text-white hover:text-aspada-gold hover:border-b-2 hover:border-aspada-gold transition-border duration-300 text-3xl font-bold uppercase"
      >News</a
    >
  </div>
</nav>

<script>
  function setupNavbar() {
    const root = document.documentElement
    const menuBtn = document.getElementById('mobile-menu-toggle')
    const navLinks = document.querySelectorAll('#mobile-menu a')

    // Toggle logic
    function toggleMenu() {
      const isOpen = root.hasAttribute('data-menu-open')
      if (isOpen) {
        root.removeAttribute('data-menu-open')
        document.body.style.overflow = ''
      } else {
        root.setAttribute('data-menu-open', '')
        document.body.style.overflow = 'hidden'
      }
    }

    menuBtn?.addEventListener('click', (e) => {
      e.preventDefault()
      toggleMenu()
    })

    // Close menu when a link is clicked
    navLinks.forEach((link) => {
      link.addEventListener('click', () => {
        root.removeAttribute('data-menu-open')
        document.body.style.overflow = ''
      })
    })

    // Scroll listener
    function handleScroll() {
      root.toggleAttribute('data-scrolled', window.scrollY > 50)
    }
    window.addEventListener('scroll', handleScroll, { passive: true })
    handleScroll()
  }

  // Run on load and after view transitions
  setupNavbar()
  document.addEventListener('astro:after-swap', setupNavbar)
</script>
