---
import type { ProjectExpand } from "../../types";
import {
  ProjectsStatusOptions,
  type ProjectsResponse,
} from "../../types/pocketbase-types";

interface Props {
  project: ProjectsResponse<ProjectExpand>;
  index: number;
}

const { project, index } = Astro.props as Props;

const location = `${project.city ?? "Unknown"}, ${project.district ?? "Unknown"}`;
const status = project.status ?? ProjectsStatusOptions.ongoing;

/**
 * Heuristic:
 * - First 3 cards load eagerly (desktop first row)
 * - Everything else lazy
 */
const eagerLoad = index < 3;
---

<style>
  @layer components {
    /* 1. Base State Setup */
    .project-card {
      transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
      will-change: transform, box-shadow;
    }

    .project-image {
      transition: transform 1.5s cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* 2. Modernized Hover State */
    @media (hover: hover) {
      .project-card:hover {
        transform: translateY(-12px);
        box-shadow:
          0 40px 80px -20px rgba(10, 25, 47, 0.4),
          0 20px 40px -25px rgba(212, 175, 55, 0.2);
      }

      .project-card:hover .project-image {
        transform: scale(1.12);
        filter: contrast(110%) brightness(105%);
      }

      .project-card:hover .project-title {
        color: var(--aspada-gold);
        text-shadow: 0 0 25px rgba(212, 175, 55, 0.2);
      }

      .project-card:hover .project-cta {
        background-color: var(--aspada-gold);
        border-color: var(--aspada-gold);
        color: #0a192f;
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(212, 175, 55, 0.4);
      }

      .project-card:hover .project-cta-icon {
        transform: translateX(6px) scale(1.1);
        transition: transform 0.5s cubic-bezier(0.68, -0.6, 0.32, 1.6);
      }
    }
  }
</style>

<a
  href={`/projects/${project.category}/${project.id}`}
  aria-label={`View ${project.title}`}
  class="project-card group relative block aspect-[4/5] w-full overflow-hidden rounded-[2rem] bg-aspada-navy shadow-2xl"
>
  {
    project.coverImage && (
      <img
        src={project.coverImage}
        alt={project.title}
        loading={eagerLoad ? "eager" : "lazy"}
        class="project-image absolute inset-0 h-full w-full object-cover opacity-90 transition-all duration-1000 ease-out group-hover:opacity-100"
      />
    )
  }

  <!-- Premium Gradient Overlay -->
  <div
    class="absolute inset-0 bg-gradient-to-t from-black/95 via-black/40 to-transparent opacity-80 transition-opacity duration-500 group-hover:opacity-90"
  >
  </div>

  <!-- Content -->
  <div class="absolute inset-0 flex flex-col justify-end p-8 sm:p-12">
    <div class="relative z-10">
      <div class="mb-6 flex flex-wrap items-center gap-4">
        <span
          class="rounded-full bg-aspada-gold/10 backdrop-blur-xl px-4 py-1.5 text-[10px] font-black uppercase tracking-[0.25em] text-aspada-gold border border-aspada-gold/30"
        >
          {status}
        </span>
        <div class="flex items-center gap-2 text-aspada-cream/80">
          <span class="i-lucide-map-pin text-xs text-aspada-gold"></span>
          <span class="text-[11px] font-bold uppercase tracking-[0.15em]"
            >{location}</span
          >
        </div>
      </div>

      <h3
        class="project-title mb-8 text-2xl font-black leading-[1.1] text-aspada-cream transition-colors duration-500 sm:text-4xl lg:text-3xl xl:text-4xl"
      >
        {project.title}
      </h3>

      <div
        class="project-cta inline-flex items-center gap-3 rounded-full border border-white/20 bg-white/5 px-8 py-3.5 text-[10px] font-black uppercase tracking-[0.3em] text-white transition-all duration-500 backdrop-blur-md"
      >
        View Project
        <span
          class="project-cta-icon i-lucide-arrow-right text-base transition-transform duration-500"
        ></span>
      </div>
    </div>
  </div>
</a>
