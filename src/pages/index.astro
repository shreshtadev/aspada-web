---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
import Hero from "../components/Hero.astro";
import Amenities from "../components/Amenities.astro";
import ActionDock from "../components/ActionDock.astro";
import Address from "../components/Address.astro";
import Testimonials from "../components/Testimonials.astro";
import Footer from "../components/Footer.astro";
import ProjectGallery from "../components/ProjectGallery.astro";
import LoadingSection from "../components/LoadingSection.astro";
import pb from "../lib/pb";
import ProjectCategory from "../components/ProjectCategory.astro";
import {
  Collections,
  ProjectsStatusOptions,
  type ProjectsResponse,
} from "../types/pocketbase-types";
import type { ProjectExpand } from "../types";

const projects = await pb
  .collection(Collections.Projects)
  .getFullList<ProjectsResponse<ProjectExpand>>({
    limit: 10,
    expand: "coverImage,projectDetails",
  });

const ongoingProjects = projects.filter(
  (project) => project.status === ProjectsStatusOptions.ongoing
);

const companyProfile = await pb
  .collection(Collections.Companies)
  .getFirstListItem(
    "companyName = '" + import.meta.env.PUBLIC_COMPANY_NAME + "'"
  );
---

<Layout title="Aspada Developers | Shivamogga's Finest">
  <Navbar companyProfile={companyProfile} />

  <main>
    <Hero projects={projects} />
    <LoadingSection
      sectionId="portfolio"
      skeletonCount={3}
      minHeight="600px"
      class="py-24 px-6"
    >
      <ProjectGallery projects={ongoingProjects} />
      <ProjectCategory />
    </LoadingSection>
    <Amenities />
    <LoadingSection
      sectionId="testimonials"
      skeletonCount={1}
      minHeight="400px"
      class="py-8 px-6"
    >
      <Testimonials />
    </LoadingSection>
    <Address />
  </main>
  <Footer companyProfile={companyProfile} />
  <ActionDock companyProfile={companyProfile} />
</Layout>
